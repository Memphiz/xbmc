BUILDTHREADS=${BUILDTHREADS:-1}
SDK_VERSION=${SDK_VERSION:-"Default"}
Configuration=${Configuration:-"Default"}
XBMC_DEPENDS_ROOT=${XBMC_DEPENDS_ROOT:-"Default"}
PATH_CHANGE_REV_FILENAME=".last_success_revision"

#set platform defaults
#$XBMC_PLATFORM_DIR matches the platform subdirs!
case $XBMC_PLATFORM_DIR in
  atv2)
    DEFAULT_SDK_VERSION=4.3
    DEFAULT_XBMC_DEPENDS_ROOT=$WORKSPACE/tools/depends/xbmc-depends
    DEFAULT_CONFIGURATION="Debug"
    ;;

  ios)
    DEFAULT_SDK_VERSION=4.3
    DEFAULT_XBMC_DEPENDS_ROOT=$WORKSPACE/tools/depends/xbmc-depends
    DEFAULT_CONFIGURATION="Debug"
    ;;

  osx32)
    DEFAULT_SDK_VERSION=10.6
    DEFAULT_XBMC_DEPENDS_ROOT=$WORKSPACE/tools/depends/xbmc-depends
    DEFAULT_CONFIGURATION="Debug"
    ;;

  osx64)
    DEFAULT_SDK_VERSION=10.6
    DEFAULT_XBMC_DEPENDS_ROOT=$WORKSPACE/tools/depends/xbmc-depends
    DEFAULT_CONFIGURATION="Debug"
    ;;
esac

if [ $SDK_VERSION == "Default" ]
then
  SDK_VERSION=$DEFAULT_SDK_VERSION
fi

if [ $XBMC_DEPENDS_ROOT == "Default" ]
then
  XBMC_DEPENDS_ROOT=$DEFAULT_XBMC_DEPENDS_ROOT
fi

if [ $Configuration == "Default" ]
then
  Configuration=$DEFAULT_CONFIGURATION
fi

#clamp release builds to 1 thread only
if [ $Configuration == "Release" ]
then
  BUILDTHREADS=1
fi

#helper function
function pathChanged ()
{
  local ret="0"
  #no optims in release builds!
  if [ $Configuration == "Release" ]
  then
    echo "1"
    return
  fi

  checkPath="$1"
  if [ -e $checkPath/$PATH_CHANGE_REV_FILENAME ]
  then
    if [ "$(cat $checkPath/$PATH_CHANGE_REV_FILENAME)" != "$(git rev-list HEAD --max-count=1  -- $checkPath)" ]
    then
      ret="1"
    fi
  else
    ret="1"
  fi
  
  echo $ret
}

